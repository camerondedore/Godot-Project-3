[gd_scene load_steps=32 format=3 uid="uid://ci5w021qks137"]

[ext_resource type="Script" path="res://C#/MobWasp/MobWasp.cs" id="1_vbe2t"]
[ext_resource type="PackedScene" uid="uid://dmttw1vyk6xy4" path="res://Models/mob-wasp.glb" id="2_blq1i"]
[ext_resource type="PackedScene" uid="uid://wiit04fu1oww" path="res://Prefabs/FX/FxWaspDeath.tscn" id="2_hegcd"]
[ext_resource type="Script" path="res://C#/Mob Tools/MobFaction.cs" id="2_xwl4h"]
[ext_resource type="Script" path="res://C#/Mob Tools/MobDetection.cs" id="3_muehp"]
[ext_resource type="AudioStream" uid="uid://bwgwc6b164o5b" path="res://Audio/mob-wasp-hit.wav" id="3_mvmjm"]
[ext_resource type="Material" uid="uid://jpvogfgug5bt" path="res://Materials/MobWasp.tres" id="3_rexv1"]
[ext_resource type="PackedScene" uid="uid://cyh65ty8moprq" path="res://Prefabs/Gibs/GibWaspAbdomen.tscn" id="6_k7c3p"]
[ext_resource type="Script" path="res://C#/GibsActivator.cs" id="6_nqxbr"]
[ext_resource type="PackedScene" uid="uid://brljsrtq78hv1" path="res://Prefabs/Gibs/GibWaspHead.tscn" id="7_hwvjs"]
[ext_resource type="PackedScene" uid="uid://b4iwcasvg6jw" path="res://Prefabs/Gibs/GibWaspMid.tscn" id="8_cmu72"]
[ext_resource type="PackedScene" uid="uid://dr67ajwiaqnkk" path="res://Prefabs/Gibs/GibWaspWingL.tscn" id="9_la8w6"]
[ext_resource type="PackedScene" uid="uid://cyp7usw06fqjr" path="res://Prefabs/Gibs/GibWaspWingR.tscn" id="10_633pr"]
[ext_resource type="AudioStream" uid="uid://130buoernvce" path="res://Audio/mob-wasp-fly.wav" id="13_yyjne"]
[ext_resource type="Script" path="res://C#/Common/AudioTools3d.cs" id="14_82ttd"]

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_2wsol"]
animation = &"wasp-hover"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_uhqfs"]
animation = &"wasp-fly"

[sub_resource type="AnimationNodeBlendSpace1D" id="AnimationNodeBlendSpace1D_at3lr"]
blend_point_0/node = SubResource("AnimationNodeAnimation_2wsol")
blend_point_0/pos = 0.0
blend_point_1/node = SubResource("AnimationNodeAnimation_uhqfs")
blend_point_1/pos = 1.0
min_space = 0.0

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ceqwu"]
animation = &"wasp-idle-flick"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_qor82"]
animation = &"wasp-idle"

[sub_resource type="AnimationNodeOneShot" id="AnimationNodeOneShot_elblp"]
filter_enabled = true
filters = ["mob-wasp-armature/Skeleton3D:wing-l", "mob-wasp-armature/Skeleton3D:wing-r"]

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_4qkcw"]
graph_offset = Vector2(-209, 56)
nodes/Animation/node = SubResource("AnimationNodeAnimation_qor82")
nodes/Animation/position = Vector2(80, 140)
"nodes/Animation 2/node" = SubResource("AnimationNodeAnimation_ceqwu")
"nodes/Animation 2/position" = Vector2(74.536, 267.531)
nodes/OneShot/node = SubResource("AnimationNodeOneShot_elblp")
nodes/OneShot/position = Vector2(300, 140)
nodes/output/position = Vector2(500, 180)
node_connections = [&"output", 0, &"OneShot", &"OneShot", 0, &"Animation", &"OneShot", 1, &"Animation 2"]

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_83ogc"]
animation = &"wasp-hit"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_ceqyv"]
xfade_time = 0.1
advance_mode = 2
advance_condition = &"hit"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_gvu1h"]
xfade_time = 0.2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_vxpty"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_fj7pu"]
advance_mode = 2
advance_condition = &"fly"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_h7fiv"]
advance_mode = 2
advance_condition = &"land"

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_wmtt0"]
states/End/position = Vector2(648, 86)
states/Fly/node = SubResource("AnimationNodeBlendSpace1D_at3lr")
states/Fly/position = Vector2(510, 86)
states/Idle/node = SubResource("AnimationNodeBlendTree_4qkcw")
states/Idle/position = Vector2(360, 86)
states/Start/position = Vector2(226, 86)
states/wasp-hit/node = SubResource("AnimationNodeAnimation_83ogc")
states/wasp-hit/position = Vector2(510, 184)
transitions = ["Fly", "wasp-hit", SubResource("AnimationNodeStateMachineTransition_ceqyv"), "wasp-hit", "Fly", SubResource("AnimationNodeStateMachineTransition_gvu1h"), "Start", "Idle", SubResource("AnimationNodeStateMachineTransition_vxpty"), "Idle", "Fly", SubResource("AnimationNodeStateMachineTransition_fj7pu"), "Fly", "Idle", SubResource("AnimationNodeStateMachineTransition_h7fiv")]
graph_offset = Vector2(-8, 11)

[sub_resource type="AnimationNodeStateMachinePlayback" id="AnimationNodeStateMachinePlayback_h8hly"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_me2gy"]
radius = 0.2
height = 0.9

[node name="MobWasp" type="CharacterBody3D" node_paths=PackedStringArray("detection", "animation", "gibsActivator", "flyAudio", "miscAudio")]
collision_layer = 512
collision_mask = 529
motion_mode = 1
script = ExtResource("1_vbe2t")
detection = NodePath("Detection")
animation = NodePath("AnimationTree")
gibsActivator = NodePath("Gibs")
flyAudio = NodePath("FlyAudio")
miscAudio = NodePath("MiscAudio")
flySound = ExtResource("13_yyjne")
hitSound = ExtResource("3_mvmjm")
waspDeathFx = ExtResource("2_hegcd")
lookSpeed = 5.0

[node name="mob-wasp" parent="." instance=ExtResource("2_blq1i")]

[node name="Skeleton3D" parent="mob-wasp/mob-wasp-armature" index="0"]
bones/0/position = Vector3(1.18259e-18, 0.00333062, 0.00222042)
bones/0/rotation = Quaternion(-0.715044, 7.76134e-17, 7.93859e-17, 0.699079)
bones/1/rotation = Quaternion(0.706802, -0.02074, 0.706803, -0.02074)
bones/2/rotation = Quaternion(0.862198, 0.0789214, 0.486818, -0.115732)
bones/3/position = Vector3(0.045136, -0.0426754, -0.0686729)
bones/3/rotation = Quaternion(-0.571923, -0.413759, -0.393989, 0.588626)
bones/4/position = Vector3(0.0470707, 0.0571496, -0.0424029)
bones/4/rotation = Quaternion(-0.490042, -0.369434, -0.286887, 0.735577)
bones/5/rotation = Quaternion(0.779725, 0.176877, 0.516422, -0.306679)
bones/6/rotation = Quaternion(0.862416, -0.0773191, -0.4869, -0.114848)
bones/7/position = Vector3(-0.0457377, -0.042653, -0.0690267)
bones/7/rotation = Quaternion(-0.589961, 0.397749, 0.413512, 0.56811)
bones/8/position = Vector3(-0.0470707, 0.0561008, -0.0424673)
bones/8/rotation = Quaternion(-0.501879, 0.359078, 0.3152, 0.720992)
bones/9/rotation = Quaternion(0.775009, -0.196358, -0.508245, -0.320143)

[node name="mob-wasp2" parent="mob-wasp/mob-wasp-armature/Skeleton3D" index="0"]
surface_material_override/0 = ExtResource("3_rexv1")

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource("AnimationNodeStateMachine_wmtt0")
anim_player = NodePath("../mob-wasp/AnimationPlayer")
active = true
parameters/playback = SubResource("AnimationNodeStateMachinePlayback_h8hly")
parameters/conditions/fly = false
parameters/conditions/hit = false
parameters/conditions/land = false
parameters/Fly/blend_position = 0.0
parameters/Idle/OneShot/active = false
parameters/Idle/OneShot/request = 0

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 0, 0)
shape = SubResource("CapsuleShape3D_me2gy")

[node name="Faction" type="Node3D" parent="."]
script = ExtResource("2_xwl4h")

[node name="Detection" type="RayCast3D" parent="." node_paths=PackedStringArray("myFaction")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -0.17214)
enabled = false
target_position = Vector3(0, 0, -1)
collision_mask = 3
script = ExtResource("3_muehp")
myFaction = NodePath("../Faction")
pointBlankRangeSqr = 1.0

[node name="Gibs" type="Node3D" parent="."]
visible = false
script = ExtResource("6_nqxbr")
speed = 4.0
randomDirectionRadius = 3.0
maxRotationSpeed = 6.0

[node name="GibWaspAbdomen" parent="Gibs" instance=ExtResource("6_k7c3p")]
transform = Transform3D(1, 0, 0, 0, 0.719073, -0.694935, 0, 0.694935, 0.719073, 0, -0.178034, 0.265597)

[node name="GibWaspHead" parent="Gibs" instance=ExtResource("7_hwvjs")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.082751, -0.24326)

[node name="GibWaspMid" parent="Gibs" instance=ExtResource("8_cmu72")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.0874378, 0.00707321)

[node name="GibWaspWingL" parent="Gibs" instance=ExtResource("9_la8w6")]
transform = Transform3D(0.939693, 0, -0.34202, -0.0885213, 0.965926, -0.24321, 0.330366, 0.258819, 0.907673, -0.2, 0.126537, 0.157943)

[node name="GibWaspWingR" parent="Gibs" instance=ExtResource("10_633pr")]
transform = Transform3D(0.939693, 0, 0.34202, 0.0885213, 0.965926, -0.24321, -0.330366, 0.258819, 0.907673, 0.2, 0.127, 0.158)

[node name="FlyAudio" type="AudioStreamPlayer3D" parent="."]
max_distance = 30.0
max_polyphony = 2
script = ExtResource("14_82ttd")

[node name="MiscAudio" type="AudioStreamPlayer3D" parent="."]
max_distance = 30.0
max_polyphony = 2
script = ExtResource("14_82ttd")

[editable path="mob-wasp"]
